<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Chat Public ‚Äì Fondation‚ÄØBackup‚ÄØSpirituel</title>

  <!-- Google Ads -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7462273633598843" crossorigin="anonymous"></script>

  <!-- Styles globaux Fondation -->
  <style>
    :root{--bleu:#003366;--bleu-clair:#0055aa;--jaune:#ffcc00;--gris:#f5f7fa;--maxw:1100px}
    *{box-sizing:border-box;margin:0;padding:0;font-family:Arial,Helvetica,sans-serif}
    body{background:#fff;color:#333;line-height:1.6}
    a{text-decoration:none;color:inherit}
    header{background:var(--bleu);color:#fff;text-align:center;padding:18px 10px}
    header img{height:85px}
    header h1{margin-top:6px;font-size:2rem;font-weight:700}
    nav{background:var(--jaune);font-weight:bold}
    nav ul{display:flex;flex-wrap:wrap;justify-content:center;gap:12px;list-style:none;padding:10px;white-space:nowrap}
    nav a{padding:10px 16px;border-radius:4px;color:var(--bleu);transition:.25s}
    nav a:hover,nav a.active{background:var(--bleu);color:#fff}
    li{position:relative}
    .dropdown-content{display:none;position:absolute;top:100%;left:0;background:var(--bleu);min-width:220px;border-radius:4px;z-index:99}
    .dropdown-content a{display:block;padding:10px 14px;color:#fff}
    .dropdown-content a:hover{background:var(--bleu-clair)}
    li.dropdown:hover .dropdown-content{display:block}
    section{max-width:var(--maxw);margin:auto;padding:50px 15px}
    h2{color:var(--bleu);text-align:center;margin-bottom:28px;font-size:2rem}
    footer{background:var(--bleu);color:#fff;text-align:center;padding:18px 10px;margin-top:60px}
    
    /* Zone Chat */
    .chat-container {
      max-width: 700px;
      margin: 0 auto;
      background: var(--gris);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    #messages {
      border: 1px solid #ccc;
      padding: 15px;
      min-height: 200px;
      max-height: 400px;
      overflow-y: auto;
      background: #fff;
      border-radius: 6px;
      margin-bottom: 20px;
      white-space: pre-wrap; /* pou kenbe espas / retou */
    }
    #messages p {
      margin-bottom: 10px;
    }
    .chat-form input[type="text"] {
      width: 100%;
      padding: 12px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-bottom: 12px;
      box-sizing: border-box;
    }
    .chat-form button {
      width: 100%;
      padding: 14px;
      font-size: 1rem;
      background-color: var(--bleu);
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s ease;
    }
    .chat-form button:hover {
      background-color: var(--bleu-clair);
    }

    @media(max-width:700px){
      header h1{font-size:1.5rem}
      nav ul{gap:6px}
    }
  </style>
</head>

<body>

<!-- ‚ñë‚ñë Header ‚ñë‚ñë -->
<header>
  <img src="logofobas.png" alt="Logo Fondation">
  <h1>FONDATION BACKUP SPIRITUEL</h1>
</header>

<!-- ‚ñë Navigation ‚ñë -->
<nav>
  <ul>
    <li><a href="index.html">Accueil</a></li>
    <li><a href="Qui-sommes-nous.html">Qui sommes‚Äënous</a></li>
    <li><a href="Parrainez-nous.html">Parrainez‚Äënous</a></li>
    <li><a href="suivi-ambassadeurs.html">Suivi Ambassadeurs</a></li>
    <li><a href="soumet-projet.html">Votre Projet Ici</a></li>
    <li><a href="eglises-nord-ouest-haiti.html">√âglises en Action</a></li>
    <li class="dropdown">
      <a href="#">Autres ‚ñæ</a>
      <ul class="dropdown-content">
        <li><a href="Nos-ambassadeurs.html">Visitez nos Ambassadeurs</a></li>
        <li><a href="Notre-ecole-d'informatique.html">Notre √âcole d'Info.</a></li>
        <li><a href="Contact.html">Contact</a></li>
        <li><a href="Actualites.html">Actualit√©s</a></li>
        <li><a href="Blagues-et-histoires.html">Blagues & Histoires</a></li>
        <li><a href="Notre-programme-d'alphabetisation.html">Prog. d'Alphab√©tisation</a></li>
        <li><a href="Emission-Backup-Spirituel.html">√âmission Backup Spirituel</a></li>
        <li><a href="Faire-un-don.html">Faire un don</a></li>
        <li><a href="Nos-actions.html">Nos actions</a></li>
        <li><a href="Politique-de-confidentialite.html">Politique de confidentialit√©</a></li>
        <li><a href="jeux-fobas.html">Jouez avec FOBAS</a></li>
      </ul>
    </li>
  </ul>
</nav>

<!-- ‚ñë Contenu Chat Public ‚ñë -->
<section>
  <h2>üí¨ Espace de Chat Public en Temps R√©el</h2>
  
  <div class="chat-container">
    <div id="messages"></div>
    <form class="chat-form" onsubmit="event.preventDefault(); sendMessage();">
      <input type="text" id="name" placeholder="Nom..." required />
      <input type="text" id="message" placeholder="Tapez votre message ici..." required />
      <button type="submit">Envoyer</button>
    </form>
  </div>

  <script src="https://js.pusher.com/7.2/pusher.min.js"></script>
  <script>
    const messagesDiv = document.getElementById("messages");

    function appendMessage(msg) {
      const p = document.createElement("p");
      p.innerText = `[${msg.timestamp}] ${msg.name}: ${msg.message}`;
      messagesDiv.appendChild(p);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    // Rechaje tout ansyen mesaj yo
    fetch("/messages/sync")
      .then(res => res.json())
      .then(data => data.forEach(appendMessage));

    // Voye nouvo mesaj
    function sendMessage() {
      const name = document.getElementById("name").value.trim();
      const message = document.getElementById("message").value.trim();
      if (!name || !message) return; // Evite mesaj vid

      const timestamp = new Date().toLocaleTimeString();

      fetch("/messages/new", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, message, timestamp }),
      });

      document.getElementById("message").value = "";
    }

    // Pusher pou resevwa an tan rey√®l
    const pusher = new Pusher("50534b64465373224fa1", {
      cluster: "us2",
    });

    const channel = pusher.subscribe("chat");
    channel.bind("newMessage", function (data) {
      appendMessage(data);
    });
  </script>
</section>

<!-- ‚ñë Footer ‚ñë -->
<footer>
  ¬© 2025 Fondation Backup Spirituel ‚Äì Tous droits r√©serv√©s.
</footer>


<script>
(async () => {
  const ref = new URLSearchParams(window.location.search).get("ref") || "Inconnu";
  const page = window.location.pathname;
  const startTime = Date.now();
  const userAgent = navigator.userAgent;

  // Antre pou kalkile klik
  let totalClicks = 0;
  document.addEventListener("click", (e) => {
    if (
      e.target.tagName === "A" || 
      e.target.tagName === "IMG" || 
      e.target.tagName === "VIDEO" || 
      e.target.closest("a") || 
      e.target.closest("img") || 
      e.target.closest("video")
    ) {
      totalClicks++;
    }
  });

  // Ranmasse IP ak peyi
  let ip = "N/A", country = "N/A";
  try {
    const res = await fetch("https://ipapi.co/json");
    const data = await res.json();
    ip = data.ip;
    country = data.country_name;
  } catch {}

  // L√® itilizat√® ap kite paj la
  window.addEventListener("beforeunload", () => {
    const endTime = Date.now();
    const durationSec = Math.round((endTime - startTime) / 1000);
    const now = new Date().toLocaleString();

    fetch("https://api.web3forms.com/submit", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        access_key: "cd9e4473-a66b-4449-93aa-b489c32a7fbd",
        subject: `üì° T√®s Avanse Ref: ${ref}`,
        from_name: "FOBAS Test Script",
        email: "fondationbackupspirituel@gmail.com",
        message: `
‚úÖ T√®s avanse ap f√®t pou kontw√≤l referans
üîó Referans: ${ref}
üìÑ Paj: ${page}
üñ±Ô∏è Klik total sou bouton/lien/imaj/videyo: ${totalClicks}
‚è±Ô∏è Tan sou paj: ${durationSec} segond
üåç Peyi: ${country}
üåê IP: ${ip}
üß≠ Navigat√®: ${userAgent}
üìÜ Dat/L√®: ${now}
        `.trim()
      })
    });
  });
})();
</script>
  
</body>
</html>
