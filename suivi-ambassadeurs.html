<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Suivi des Ambassadeurs Digitaux - Fondation Backup Spirituel</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
    }
    header {
      background-color: #003366;
      color: white;
      padding: 20px;
      text-align: center;
    }
    nav {
      background-color: yellow;
      padding: 10px;
      text-align: center;
    }
    nav a {
      margin: 0 15px;
      color: #003366;
      text-decoration: none;
      font-weight: bold;
    }
    nav a:hover {
      background-color: #003366;
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
    }
    main {
      padding: 40px;
      background-color: #fff;
    }
    footer {
      background-color: #003366;
      color: white;
      text-align: center;
      padding: 20px;
    }
    .description {
      max-width: 800px;
      margin: auto;
      text-align: center;
      color: #003366;
    }
    .description h2 {
      color: #003366;
    }
  </style>
</head>
<body>
  <header>
    <img src="logofobas.png" alt="Logo Fondation Backup Spirituel" height="80" />
    <h1>Suivi des Ambassadeurs Digitaux</h1>
  </header>
  <nav>
    <a href="/">Accueil</a>
    <a href="/apropos.html">√Ä Propos</a>
    <a href="/contact.html">Contact</a>
    <a href="/devenir-ambassadeur.html">Devenir Ambassadeur</a>
  </nav>

  <main>
    <div class="description">
      <h2>üåç Rejoignez le Mouvement Digital de la Fondation!</h2>
      <p>
        En tant qu‚ÄôAmbassadeur Digital, vous devenez la voix et la lumi√®re de notre Fondation √† travers le monde.<br />
        Vous inspirez, motivez et attirez des √¢mes nouvelles vers notre vision commune.<br />
        Chaque action que vous entreprenez compte : partagez, motivez, connectez.<br />
        Ce tableau de bord permet de suivre votre impact au quotidien.<br />
        Engagez-vous avec c≈ìur et int√©grit√©, votre influence compte vraiment.<br />
        Notre Fondation valorise votre effort et reconna√Æt votre contribution r√©elle.<br />
        C‚Äôest ici que tout commence, ici que vous laissez votre empreinte! üåü<br /><br />
        <em>üá∫üá∏ As a Digital Ambassador, you're the voice and light of our Foundation across the world.<br />
        This tracking page shows the real influence of your actions. Share wisely, act with purpose! üí´</em>
      </p>
    </div>
  </main>

  <footer>
    <p>&copy; 2025 Fondation Backup Spirituel. Tous droits r√©serv√©s.</p>
  </footer>

  <!-- ‚úÖ SCRIPT AUTO TRACKING REF AMBASSADEUR -->
  <script>
  (async () => {
    const urlParams = new URLSearchParams(window.location.search);
    const ref = urlParams.get("ref");
    if (!ref) return;

    const now = new Date();
    const dateISO = now.toISOString().slice(0, 10);
    const lastKey = `ambassador-last-track-${ref}`;
    const lastTracked = localStorage.getItem(lastKey);

    if (lastTracked === dateISO) return;

    localStorage.setItem(lastKey, dateISO);

    let ip = "N/A";
    try {
      const res = await fetch("https://api.ipify.org?format=json");
      const data = await res.json();
      ip = data.ip;
    } catch (err) {
      console.warn("IP pa disponib", err);
    }

    await fetch("https://api.web3forms.com/submit", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        access_key: "cd9e4473-a66b-4449-93aa-b489c32a7fbd",
        from_name: "Suivi Ambassadeur FOBAS",
        subject: `üß≠ Vizit pa ${ref}`,
        message: `Nouvo vizit soti nan Ambassadeur: ${ref}\nüïì Dat ak l√®: ${now.toLocaleString()}\nüåê IP: ${ip}\nüìÑ Paj vizite: ${location.href}`,
        email: "fondationbackupspirituel@gmail.com"
      })
    });
  })();
  </script>


 <!-- ‚úÖ SCRIPT 1: DETEKTE BOT AK AL√àT OTOMATIK VIA WEB3FORMS -->
<script>
(async () => {
  const knownBots = [
    /bot/i,
    /crawl/i,
    /spider/i,
    /slurp/i,
    /fetch/i,
    /parser/i,
    /ahrefs/i,
    /semrush/i,
    /mj12/i,
    /baidu/i
  ];

  const userAgent = navigator.userAgent;
  const isBot = knownBots.some(pattern => pattern.test(userAgent));
  const now = new Date().toLocaleString();

  if (isBot) {
    const ip = await fetch("https://api.ipify.org?format=json")
      .then(res => res.json())
      .then(data => data.ip)
      .catch(() => "IP non disponible");

    await fetch("https://api.web3forms.com/submit", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        access_key: "34c56edb-5db8-45f4-aa97-376ddc127b4d",
        subject: "‚ö†Ô∏è Bot sisp√®k vizite sit la!",
        from_name: "S√©curit√© du site Fondation Backup Spirituel",
        email: "infos@fondationbackupspirituel.com",
        message: "‚ö†Ô∏è Bot sisp√®k vizite sit la!",
        userAgent: userAgent,
        url: location.href,
        ip_address: ip,
        date_time: now
      })
    });
    console.warn("‚ö†Ô∏è Bot detekte: ", userAgent);
  }
})();
</script>

<!-- ‚úÖ SCRIPT 2: DETEKTE CLIK ANONS REPETITIF KI SISP√àK -->
<script>
(function () {
  const adClickKey = "fobas-ad-click-count";
  const lastClickKey = "fobas-last-click-time";
  const now = Date.now();
  const dateTime = new Date().toLocaleString();
  const last = parseInt(localStorage.getItem(lastClickKey) || "0");
  const clicks = parseInt(localStorage.getItem(adClickKey) || "0");

  if (now - last < 10 * 60 * 1000 && clicks >= 3) {
    fetch("https://api.ipify.org?format=json")
      .then(res => res.json())
      .then(data => {
        fetch("https://api.web3forms.com/submit", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            access_key: "34c56edb-5db8-45f4-aa97-376ddc127b4d",
            subject: "‚ö†Ô∏è Klik anons sisp√®k f√®t sou sit la!",
            from_name: "S√©curit√© du site Fondation Backup Spirituel",
            email: "infos@fondationbackupspirituel.com",
            message: `‚ö†Ô∏è Yon itilizat√® f√® ${clicks} klik rapid sou anons.`,
            page: window.location.href,
            ip_address: data.ip,
            date_time: dateTime
          })
        });
        console.warn("‚ö†Ô∏è Aktivite klik sisp√®k sou anons.");
      }).catch(() => {
        console.warn("‚ö†Ô∏è Pa ka jwenn IP pou klik sisp√®k.");
      });
  }

  document.addEventListener("click", (e) => {
    if (e.target.closest(".adsbygoogle")) {
      localStorage.setItem(lastClickKey, Date.now());
      localStorage.setItem(adClickKey, clicks + 1);
    }
  });
})();
</script>


<script>
(async () => {
  const ref = new URLSearchParams(window.location.search).get("ref") || "Inconnu";
  const page = window.location.pathname;
  const now = Date.now();
  const start = now;
  const date = new Date().toLocaleString();
  const userAgent = navigator.userAgent;

  // API pou jwenn IP vizit√® a
  let ip = "N/A";
  try {
    const res = await fetch("https://api.ipify.org?format=json");
    ip = (await res.json()).ip;
  } catch {}

  // Init tracking
  let clicks = 0;
  document.addEventListener("click", () => clicks++);

  // Ranmase done sou chak paj
  const sessionKey = `ambassador_${ref}_track`;
  const existing = JSON.parse(localStorage.getItem(sessionKey)) || {
    pages: [],
    clicks: 0,
    startTime: now
  };

  existing.pages.push(page);
  existing.clicks += 0;
  localStorage.setItem(sessionKey, JSON.stringify(existing));

  // Voye al√®t chak 24h
  const alertKey = `ambassador_${ref}_last_alert`;
  const lastAlert = parseInt(localStorage.getItem(alertKey) || "0");

  const isNewDay = now - lastAlert > 24 * 60 * 60 * 1000;

  window.addEventListener("beforeunload", async () => {
    const end = Date.now();
    const duration = Math.round((end - start) / 1000); // an segond
    existing.clicks += clicks;
    localStorage.setItem(sessionKey, JSON.stringify(existing));

    if (isNewDay) {
      await fetch("https://api.web3forms.com/submit", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          access_key: "cd9e4473-a66b-4449-93aa-b489c32a7fbd",
          from_name: "Fobas Tracker",
          subject: `üìà Aktivite vizit√® ref: ${ref}`,
          email: "fondationbackupspirituel@gmail.com",
          message: `
üß≠ Referans: ${ref}
üìÑ Paj vizite: ${[...new Set(existing.pages)].join(", ")}
üñ±Ô∏è Klik total: ${existing.clicks}
‚è±Ô∏è Tan sou d√®nye paj: ${duration} segond
üåê IP: ${ip}
üì± Navigat√®: ${userAgent}
üìÜ Dat ak l√®: ${date}
          `.trim()
        })
      });

      localStorage.setItem(alertKey, now.toString());
      localStorage.removeItem(sessionKey); // Netwaye pou demen
    }
  });
})();
</script>
  
</body>
</html>
